name: db
description: runs MySQL database
inputs:
  appDir:
    dir:
      description: Application root direactory
      default: .
  dbPassword:
    string:
      description: password to connect to the database
      default: password
  dbSchema:
    string:
      description: name of the database to be created
      default: miniurl
  mysqlCnf:
    file:
      default: /my.cnf
run:
  serial:
    - op:
        ref: db-init
        inputs: { appDir }
    - container:
        image: { ref: 'mysql:8.0.13' }
        name: miniurldb
        files:
          /etc/mysql/conf.d/mysqld_settings.cnf: $(mysqlCnf) 
        dirs: { '/var/lib/mysql': $(appDir/db/data/mysql) }
        envVars:
          MYSQL_ROOT_PASSWORD: $(dbPassword)
          MYSQL_DATABASE: $(dbSchema)
        ports: { '3306':'3306' }
